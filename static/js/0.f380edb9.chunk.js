(this.webpackJsonpinstagram_clone=this.webpackJsonpinstagram_clone||[]).push([[0],{55:function(e,t,r){"use strict";r.d(t,"d",(function(){return l})),r.d(t,"j",(function(){return f})),r.d(t,"i",(function(){return b})),r.d(t,"h",(function(){return m})),r.d(t,"p",(function(){return j})),r.d(t,"o",(function(){return O})),r.d(t,"f",(function(){return v})),r.d(t,"e",(function(){return y})),r.d(t,"k",(function(){return N})),r.d(t,"l",(function(){return L})),r.d(t,"n",(function(){return M})),r.d(t,"q",(function(){return R})),r.d(t,"m",(function(){return _})),r.d(t,"g",(function(){return B})),r.d(t,"b",(function(){return F})),r.d(t,"a",(function(){return J})),r.d(t,"c",(function(){return q}));var n=r(30),a=r(58),c=r(16),o=r(53),s=r.n(o),u=r(54),i=r(25);function l(e){return d.apply(this,arguments)}function d(){return(d=Object(u.a)(s.a.mark((function e(t){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.b.firestore().collection("users").where("username","==",t).get();case 2:return r=e.sent,e.abrupt("return",r.docs.length>0);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return p.apply(this,arguments)}function p(){return(p=Object(u.a)(s.a.mark((function e(t){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.b.firestore().collection("users").where("username","==",t).get();case 2:return r=e.sent,e.abrupt("return",r.docs.map((function(e){return Object(c.a)(Object(c.a)({},e.data()),{},{docId:e.id})})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return h.apply(this,arguments)}function h(){return(h=Object(u.a)(s.a.mark((function e(t){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.b.firestore().collection("users").where("userId","==",t).get();case 2:return r=e.sent,e.abrupt("return",r.docs.map((function(e){return Object(c.a)(Object(c.a)({},e.data()),{},{docId:e.id})})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e,t){return x.apply(this,arguments)}function x(){return(x=Object(u.a)(s.a.mark((function e(t,r){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.b.firestore().collection("users").limit(10).get();case 2:return n=e.sent,e.abrupt("return",n.docs.map((function(e){return Object(c.a)(Object(c.a)({},e.data()),{},{docId:e.id})})).filter((function(e){return e.userId!==t&&!r.includes(e.userId)})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,t,r){return g.apply(this,arguments)}function g(){return(g=Object(u.a)(s.a.mark((function e(t,r,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.b.firestore().collection("users").doc(t).update({following:n?i.a.arrayRemove(r):i.a.arrayUnion(r)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e,t,r){return w.apply(this,arguments)}function w(){return(w=Object(u.a)(s.a.mark((function e(t,r,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.b.firestore().collection("users").doc(t).update({followers:n?i.a.arrayRemove(r):i.a.arrayUnion(r)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e,t,r){return k.apply(this,arguments)}function k(){return(k=Object(u.a)(s.a.mark((function e(t,r,n){var o,l,d,f,p,h,m;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.b.firestore().collection("photos").where("userId","in",r).get();case 2:return o=e.sent,l=o.docs.map((function(e){return Object(c.a)(Object(c.a)({},e.data()),{},{docId:e.id})})),e.next=6,Promise.all(l.map(function(){var e=Object(u.a)(s.a.mark((function e(r){var n,a,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!1,r.likes.includes(t)&&(n=!0),e.next=4,b(r.userId);case 4:return a=e.sent,o=a[0].username,e.abrupt("return",Object(c.a)(Object(c.a)({username:o},r),{},{userLikedPhoto:n}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:return d=e.sent,e.next=9,i.b.firestore().collection("photos").where("username","==",n).get();case 9:return f=e.sent,p=f.docs.map((function(e){return Object(c.a)(Object(c.a)({},e.data()),{},{docId:e.id})})),e.next=13,Promise.all(p.map(function(){var e=Object(u.a)(s.a.mark((function e(r){var n,a,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!1,r.likes.includes(t)&&(n=!0),e.next=4,b(r.userId);case 4:return a=e.sent,o=a[0].username,e.abrupt("return",Object(c.a)(Object(c.a)({username:o},r),{},{userLikedPhoto:n}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 13:return h=e.sent,m=[].concat(Object(a.a)(d),Object(a.a)(h)),e.abrupt("return",m);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return I.apply(this,arguments)}function I(){return(I=Object(u.a)(s.a.mark((function e(t){var r,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.b.firestore().collection("users").where("userId","in",t).get();case 2:return r=e.sent,n=r.docs.map((function(e){return Object(c.a)({},e.data())})),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e){return S.apply(this,arguments)}function S(){return(S=Object(u.a)(s.a.mark((function e(t){var r,a,o,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(t);case 2:return r=e.sent,a=Object(n.a)(r,1),o=a[0],e.next=7,i.b.firestore().collection("photos").where("userId","==",o.userId).get();case 7:return u=e.sent,e.abrupt("return",u.docs.map((function(e){return Object(c.a)(Object(c.a)({},e.data()),{},{docId:e.id,username:t})})));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e,t){return C.apply(this,arguments)}function C(){return(C=Object(u.a)(s.a.mark((function e(t,r){var a,o,u,l,d;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.b.firestore().collection("users").where("username","==",t).where("following","array-contains",r).get();case 2:return a=e.sent,o=a.docs.map((function(e){return Object(c.a)(Object(c.a)({},e.data()),{},{docId:e.id})})),u=Object(n.a)(o,1),l=u[0],d=void 0===l?{}:l,e.abrupt("return",d.userId);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e,t,r,n,a){return P.apply(this,arguments)}function P(){return(P=Object(u.a)(s.a.mark((function e(t,r,n,a,c){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(r,a,t);case 2:return e.next=4,O(n,c,t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e,t,r){return D.apply(this,arguments)}function D(){return(D=Object(u.a)(s.a.mark((function e(t,r,n){var a,c,o,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.avatarStorageName,c="".concat(Math.round(1e6*Math.random()),".").concat(n),i.b.firestore().collection("users").doc(t.docId).update({avatar:"https://firebasestorage.googleapis.com/v0/b/instagram-clone-fb42d.appspot.com/o/".concat(c,"?alt=media"),avatarStorageName:"".concat(c)}),o=i.b.storage().ref(),o.child(c).putString(r,"data_url").then((function(){console.log("uploaded file",c)})),u=o.child("".concat(a)),"no-img.png"!==a&&u.delete().then((function(){console.log("file successfully deleted")})).catch((function(e){console.log(e)}));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e,t,r,n){return U.apply(this,arguments)}function U(){return(U=Object(u.a)(s.a.mark((function e(t,r,n,a){var c,o,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c="".concat(Math.round(1e6*Math.random()),".").concat(a),o=i.b.firestore().collection("photos").doc(),console.log("fileName",a),o.set({caption:n,comments:[],likes:[],docId:o.id,userId:t.userId,username:t.username,dateCreated:Date.now(),imageSrc:"https://firebasestorage.googleapis.com/v0/b/instagram-clone-fb42d.appspot.com/o/".concat(c,"?alt=media"),photoStorageName:c}),u=i.b.storage().ref(),u.child(c).putString(r,"data_url");case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e,t){return E.apply(this,arguments)}function E(){return(E=Object(u.a)(s.a.mark((function e(t,r){var n,a,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.b.firestore().collection("photos").where("docId","==",t).get();case 2:return n=e.sent,a=n.docs.map((function(e){return Object(c.a)(Object(c.a)({},e.data()),{},{docId:e.id})})),e.next=6,Promise.all(a.map(function(){var e=Object(u.a)(s.a.mark((function e(t){var n,a,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!1,t.likes.includes(r)&&(n=!0),e.next=4,b(t.userId);case 4:return a=e.sent,o=a[0].username,e.abrupt("return",Object(c.a)(Object(c.a)({username:o},t),{},{userLikedPhoto:n}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:return o=e.sent,e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e,t){return H.apply(this,arguments)}function H(){return(H=Object(u.a)(s.a.mark((function e(t,r){var n,a,c,o,u,l,d,f,p;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.b.firestore().collection("photos").doc(t).get();case 2:return n=e.sent,console.log(n),console.log(n.data()),e.next=7,n.data().comments;case 7:return a=e.sent,e.next=10,n.data().likes;case 10:if(c=e.sent,console.log("comments",a),console.log("likes",c),void 0===c){e.next=25;break}o=0;case 15:if(!(o<c.length)){e.next=25;break}return e.next=18,b(c[o]);case 18:return u=e.sent,e.next=21,i.b.firestore().collection("users").doc(u[0].docId).update({likes:i.a.arrayRemove(t)});case 21:console.log("2");case 22:o++,e.next=15;break;case 25:if(void 0===a){e.next=33;break}l=s.a.mark((function e(t){var r,n,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a[t].commentId,e.next=3,i.b.firestore().collection("users").doc(a[t].userDocId).get();case 3:return n=(n=e.sent).data(),console.log(n),c=n.comments.filter((function(e){return e.commentId!==r})),e.next=9,i.b.firestore().collection("users").doc(a[t].userDocId).set({comments:c},{merge:!0});case 9:case"end":return e.stop()}}),e)})),d=0;case 28:if(!(d<a.length)){e.next=33;break}return e.delegateYield(l(d),"t0",30);case 30:d++,e.next=28;break;case 33:return e.next=35,i.b.firestore().collection("photos").doc(t).delete().then((function(){console.log("Document successfully deleted!")})).catch((function(e){console.error("Error removing document: ",e)}));case 35:f=i.b.storage().ref(),p=f.child("".concat(r)),"no-img.png"!==r&&p.delete().then((function(){console.log("file successfully deleted")})).catch((function(e){console.log(e)}));case 38:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e,t,r,n){return W.apply(this,arguments)}function W(){return(W=Object(u.a)(s.a.mark((function e(t,r,n,a){var c,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=r.filter((function(e){return e.commentId!==n})),i.b.firestore().collection("photos").doc(t).set({comments:c},{merge:!0}),o=a.comments.filter((function(e){return e.commentId!==n})),i.b.firestore().collection("users").doc(a.docId).set({comments:o},{merge:!0});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return z.apply(this,arguments)}function z(){return(z=Object(u.a)(s.a.mark((function e(t){var r,n,a,o,u,l,d,f,p,b,h,m,x,j,g,O,w,v,k;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.userId,n=t.following,a=t.followers,o=t.docId,u=t.comments,l=t.likes,void 0===n){e.next=12;break}d=0;case 3:if(!(d<n.length)){e.next=12;break}return e.next=6,i.b.firestore().collection("users").where("userId","==",n[d]).get();case 6:f=(f=e.sent).docs.map((function(e){return Object(c.a)(Object(c.a)({},e.data()),{},{docId:e.id})})),i.b.firestore().collection("users").doc(f[0].docId).update({followers:i.a.arrayRemove(r)});case 9:d++,e.next=3;break;case 12:if(void 0===a){e.next=23;break}p=0;case 14:if(!(p<a.length)){e.next=23;break}return e.next=17,i.b.firestore().collection("users").where("userId","==",a[p]).get();case 17:b=(b=e.sent).docs.map((function(e){return Object(c.a)(Object(c.a)({},e.data()),{},{docId:e.id})})),i.b.firestore().collection("users").doc(b[0].docId).update({following:i.a.arrayRemove(r)});case 20:p++,e.next=14;break;case 23:if(void 0===u){e.next=36;break}h=0;case 25:if(!(h<u.length)){e.next=36;break}return m=u[h].photoDocId,x=u[h].commentId,e.next=30,B(m,r);case 30:j=e.sent,g=j[0].comments,J(m,g,x,t);case 33:h++,e.next=25;break;case 36:if(void 0===l){e.next=46;break}O=0;case 38:if(!(O<l.length)){e.next=46;break}return e.next=41,i.b.firestore().collection("photos").doc(l[O]).update({likes:i.a.arrayRemove(r)});case 41:return e.next=43,i.b.firestore().collection("users").doc(o).update({likes:i.a.arrayRemove(l[O])});case 43:O++,e.next=38;break;case 46:return console.log("delete: "+r),e.next=49,i.b.firestore().collection("photos").where("userId","==",r).get();case 49:for(w=(w=e.sent).docs.map((function(e){return Object(c.a)(Object(c.a)({},e.data()),{},{docId:e.id})})),console.log(w),v=0;v<w.length;v++)k=w[v].photoStorageName,F(w[v].docId,k);return i.b.auth().currentUser.delete().then((function(){console.log("deleted from auth")})).catch((function(e){console.log(e)})),e.next=57,i.b.firestore().collection("users").doc(o).delete();case 57:i.b.auth().signOut();case 58:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},56:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var n=r(53),a=r.n(n),c=r(54),o=r(30),s=r(1),u=r(31),i=r(55);function l(){var e=Object(s.useState)({}),t=Object(o.a)(e,2),r=t[0],n=t[1],l=Object(s.useContext)(u.a).user;return Object(s.useEffect)((function(){function e(){return(e=Object(c.a)(a.a.mark((function e(){var t,r,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.i)(l.uid);case 2:t=e.sent,r=Object(o.a)(t,1),c=r[0],n(c);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(null===l||void 0===l?void 0:l.uid)&&function(){e.apply(this,arguments)}()}),[l]),{userInfo:r}}},61:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var n=r(1),a=r(18),c=r(19),o=r(31),s=r(13),u=r(56),i=r.p+"static/media/newPost.84a497c2.png",l=r(5),d=r(4);function f(){var e=Object(n.useContext)(c.a).firebase,t=Object(n.useContext)(o.a).user,r=Object(u.a)().userInfo,f=Object(l.g)();return Object(d.jsx)("header",{className:"h-16 bg-white border-b border-gray-primary sticky top-0 z-50",children:Object(d.jsx)("div",{className:"container mx-auto max-w-screen-lg h-full",children:Object(d.jsxs)("div",{className:"flex justify-between h-full",children:[Object(d.jsx)("div",{className:"text-gray-700 text-center flex items-center align-items cursor-pointer",children:Object(d.jsx)("h1",{className:"flex justify-center w-full",children:Object(d.jsx)(a.b,{to:s.a,"aria-label":"instagram header",children:Object(d.jsx)("img",{src:"/images/logo.png",alt:"instagram header",className:"mt-2 w-6/12"})})})}),Object(d.jsx)("div",{className:"text-gray-700 text-center flex items-center align-items",children:t?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(a.b,{to:{pathname:"".concat(s.g),state:{type:"post"}},"aria-label":"upload post",children:Object(d.jsx)("img",{src:i,alt:"add post",className:"w-8 mr-6 cursor-pointer"})}),Object(d.jsx)(a.b,{to:s.a,"aria-label":"timeline",children:Object(d.jsxs)("svg",{className:"w-8 mr-6 text-black-light cursor-pointer",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[Object(d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"}),Object(d.jsx)("title",{children:"Timeline"})]})}),Object(d.jsx)("button",{type:"button",title:"Sign-out",onClick:function(){return e.auth().signOut()},onKeyDown:function(t){"enter"===t.key&&(f.push("/login"),e.auth().signOut())},children:Object(d.jsx)("svg",{className:"w-8 mr-6 text-black-light cursor-pointer",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:Object(d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})}),Object(d.jsx)("div",{className:"flex items-center cursor-pointer",children:Object(d.jsx)(a.b,{to:"/p/".concat(r.username),children:Object(d.jsx)("img",{title:"".concat(r.username),className:"rounded-full h-8 w-8 flex object-cover",src:"".concat(r.avatar),alt:"".concat(r.username," profile")})})})]}):Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(a.b,{to:s.b,children:Object(d.jsx)("button",{type:"button",className:"bg-blue-primary font-bold text-sm rounded text-white w-20 h-8",children:"Login"})}),Object(d.jsx)(a.b,{to:s.f,children:Object(d.jsx)("button",{type:"button",className:"bg-white font-bold text-sm rounded text-blue-primary w-20 h-8",children:"Sign-up"})})]})})]})})})}}}]);
//# sourceMappingURL=0.f380edb9.chunk.js.map